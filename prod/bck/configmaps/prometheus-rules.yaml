apiVersion: v1
data:
  alert.rules: "\ngroups:\n- name: example\n  rules:\n  - alert: InstanceDown\n    expr:
    up == 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n
    \     summary: \"{{ $labels.instance }} of job {{ $labels.job }} has been down
    for more than 5 minutes\"\n      description: \" {{ $labels.instance }}\\n {{
    $labels.app_kubernetes_io_name}}\\n {{ $labels.kubernetes_pod_name}}\"\n    #-------------------------------------------------------------------------------------------------------------------------------------------\n
    \ - alert: New Instance\n    expr: rate(up{job=\"kubernetes-nodes\",cloud_google_com_gke_nodepool!~\"(jenkins|nodejs-pool)-.*\"}[1m])
    unless rate(up{job=\"kubernetes-nodes\",cloud_google_com_gke_nodepool!~\"(jenkins|nodejs-pool)-.*\"}[1m]
    offset 3m)\n    for: 1m\n    labels:\n      severity: info\n    annotations:\n
    \     summary: \"{{ $labels.instance }}\"\n      description: \"pool: {{ $labels.cloud_google_com_gke_nodepool
    }}\\n region: {{ $labels.failure_domain_beta_kubernetes_io_region }}\\n zone:
    {{ $labels.failure_domain_beta_kubernetes_io_zone }}\"\n  - alert: Instance removed\n
    \   expr: rate(up{job=\"kubernetes-nodes\",cloud_google_com_gke_nodepool!~\"(jenkins|nodejs-pool)-.*\"}[1m]
    offset 3m) unless rate(up{job=\"kubernetes-nodes\",cloud_google_com_gke_nodepool!~\"(jenkins|nodejs-pool)-.*\"}[1m])\n
    \   for: 1m\n    labels:\n      severity: info\n    annotations:\n      summary:
    \"{{ $labels.instance }}\"\n      description: \"pool: {{ $labels.cloud_google_com_gke_nodepool
    }}\\n region: {{ $labels.failure_domain_beta_kubernetes_io_region }}\\n zone:
    {{ $labels.failure_domain_beta_kubernetes_io_zone }}\"\n  - alert: Low Disk Space\n
    \   expr: 100 - (container_fs_usage_bytes{device=~\"^/dev/[sv]d[a-z][1-9]$\",id=\"/\"}
    / container_fs_limit_bytes{device=~\"^/dev/[sv]d[a-z][1-9]$\",id=\"/\"}*100) <
    19\n    for: 1m\n    labels: \n      severity: critical\n    annotations:\n      summary:
    \"{{$labels.instance}}: {{ $value }} %\"\n  - alert: Low Volume Space\n    expr:
    (kubelet_volume_stats_available_bytes/kubelet_volume_stats_capacity_bytes and
    kubelet_volume_stats_capacity_bytes) * 100 < 19\n    for: 1m\n    labels:\n      severity:
    critical\n    annotations:\n      summary: \"{{$labels.persistentvolumeclaim}}:
    {{ $value }} %\"\n      description: \"pool: {{ $labels.cloud_google_com_gke_nodepool
    }}\\n region: {{ $labels.failure_domain_beta_kubernetes_io_region }}\\n zone:
    {{ $labels.failure_domain_beta_kubernetes_io_zone }}\"\n  - alert: High CPU Usage\n
    \   expr: sum (rate (container_cpu_usage_seconds_total{id=\"/\"}[10m])) / sum
    (machine_cpu_cores) * 100 > 70\n    for: 1m\n    labels: \n      severity: warning\n
    \   annotations:\n      summary: \"{{ $value }} %\"\n  - alert: Low Free Memory\n
    \   expr: ((container_spec_memory_limit_bytes{id=\"/\"} - container_memory_working_set_bytes{id=\"/\"})
    / container_spec_memory_limit_bytes{id=\"/\"} * 100) < 15\n    for: 1m\n    labels:
    \n      severity: critical\n    annotations:\n      summary: \"{{$labels.instance}}:
    {{ $value }} %\"\n      description: \"pool: {{ $labels.cloud_google_com_gke_nodepool
    }}\\n region: {{ $labels.failure_domain_beta_kubernetes_io_region }}\\n zone:
    {{ $labels.failure_domain_beta_kubernetes_io_zone }}\"\n  - alert: Hight Network
    \ Receive\n    expr: (sum (rate (container_network_receive_bytes_total[10m]))
    / 1024 / 1024 > 60)\n    for: 10m\n    labels: \n      severity: warning\n    annotations:\n
    \     summary: \"{{ $value }} MB/s\"\n  - alert: Hight Network Transmit\n    expr:
    (sum (rate (container_network_transmit_bytes_total[10m])) / 1024 / 1024 > 20)\n
    \   for: 10m\n    labels: \n      severity: warning\n    annotations:\n      summary:
    \"{{ $value }} MB/s\"\n  - alert: High_ErrorRate 5xx\n    expr: sum by(job,path)(rate(http_requests_total{code=~\"5..\"}[5m]))
    / sum by(job,path)(rate(http_requests_total[5m])) * 100 > 1\n    for: 10m\n    labels:
    \n      severity: warning\n    annotations:\n      summary: \"{{$labels.instance}}
    high number of 5xx errors\"\n      description: \"{{$labels.instance}}: {{$labels.job}}
    has {{$value}}% 5xx errors on {{$labels.path}}\"\n  - alert: High_ErrorRate 4xx\n
    \   expr: sum by(job,path)(rate(http_requests_total{code=~\"4..\"}[5m])) / sum
    by(job,path)(rate(http_requests_total[5m])) * 100 > 1\n    for: 10m\n    labels:
    \n      severity: warning\n    annotations:\n      summary: \"{{$labels.instance}}
    high number of 4xx errors\"\n      description: \"{{$labels.instance}}: {{$labels.job}}
    has {{$value}}% 5xx errors on {{$labels.path}}\"\n  - alert: TooMany_OpenFileDescriptors\n
    \   expr: 100 * (process_open_fds / process_max_fds) > 50\n    for: 10m\n    labels:\n
    \     severity: critical\n    annotations:\n      description: '{{ $labels.job
    }}: {{ $labels.namespace }}/{{ $labels.pod }} ({{$labels.instance }}) is using
    {{ $value }}% of the available file/socket descriptors.'\n      summary: Too many
    open file descriptors\n    #-------------------------------------------------------------------------------------------------------------------------------------------\n
    \   # MongoDB alerts\n  - alert: MONGO_DB__TO_MANY_OPEN_CONNECTIONS\n    expr:
    mongodb_connections{state=\"current\"} > 80\n    for: 2m\n    labels:\n      severity:
    warning\n    annotations:\n      description: \"value is higher ({{ $value }})
    than expected (80) during last 2 minutes\"\n  - alert: MONGO_DB__REPLICATION_LAG_BY_SET\n
    \   expr: max(mongodb_mongod_replset_member_optime_date{state=\"PRIMARY\"}) by
    (set) - min(mongodb_mongod_replset_member_optime_date{state=\"SECONDARY\"}) by
    (set)> 15\n    for: 2m\n    labels:\n      severity: warning\n    annotations:\n
    \     summary: Replication Lag by Set\n      description: \"value is higher ({{
    $value }}) than expected (20) during last 2 minutes\"\n  - alert: MONGO_DB__UNEXPECTED_REPLICA_SET_STATE\n
    \   expr: mongodb_mongod_replset_my_state!=1 and mongodb_mongod_replset_my_state!=2
    and mongodb_mongod_replset_my_state!=7\n    for: 2m\n    labels:\n      severity:
    warning\n    annotations:\n      summary: Unexpected ReplicaSet State\n      description:
    \"value ({{ $value }}) is not of of PRIMARY,SECONDARY,ARBITER\"\n  - alert: MONGO_DB__MIN_RUN_INSTANCES\n
    \   expr: count(mongodb_mongod_replset_member_health)<3\n    for: 2m\n    labels:\n
    \     severity: warning\n    annotations:\n      summary: Some MongoDB instances
    are not reachable\n      description: \"theare are only ({{ $value }}) instances\"\n
    \ - alert: MGOB_DUMP_FAILED\n    expr: (sum (rate (mgob_scheduler_backup_latency{status=\"500\"}[10m]))
    \ > 0)\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n
    \     summary: Some MGOB dumps failed"
kind: ConfigMap
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","data":{"alert.rules":"\ngroups:\n- name: example\n  rules:\n  - alert: InstanceDown\n    expr: up == 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: \"{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes\"\n      description: \" {{ $labels.instance }}\\n {{ $labels.app_kubernetes_io_name}}\\n {{ $labels.kubernetes_pod_name}}\"\n    #-------------------------------------------------------------------------------------------------------------------------------------------\n  - alert: New Instance\n    expr: rate(up{job=\"kubernetes-nodes\",cloud_google_com_gke_nodepool!~\"(jenkins|nodejs-pool)-.*\"}[1m]) unless rate(up{job=\"kubernetes-nodes\",cloud_google_com_gke_nodepool!~\"(jenkins|nodejs-pool)-.*\"}[1m] offset 3m)\n    for: 1m\n    labels:\n      severity: info\n    annotations:\n      summary: \"{{ $labels.instance }}\"\n      description: \"pool: {{ $labels.cloud_google_com_gke_nodepool }}\\n region: {{ $labels.failure_domain_beta_kubernetes_io_region }}\\n zone: {{ $labels.failure_domain_beta_kubernetes_io_zone }}\"\n  - alert: Instance removed\n    expr: rate(up{job=\"kubernetes-nodes\",cloud_google_com_gke_nodepool!~\"(jenkins|nodejs-pool)-.*\"}[1m] offset 3m) unless rate(up{job=\"kubernetes-nodes\",cloud_google_com_gke_nodepool!~\"(jenkins|nodejs-pool)-.*\"}[1m])\n    for: 1m\n    labels:\n      severity: info\n    annotations:\n      summary: \"{{ $labels.instance }}\"\n      description: \"pool: {{ $labels.cloud_google_com_gke_nodepool }}\\n region: {{ $labels.failure_domain_beta_kubernetes_io_region }}\\n zone: {{ $labels.failure_domain_beta_kubernetes_io_zone }}\"\n  - alert: Low Disk Space\n    expr: 100 - (container_fs_usage_bytes{device=~\"^/dev/[sv]d[a-z][1-9]$\",id=\"/\"} / container_fs_limit_bytes{device=~\"^/dev/[sv]d[a-z][1-9]$\",id=\"/\"}*100) \u003c 19\n    for: 1m\n    labels: \n      severity: critical\n    annotations:\n      summary: \"{{$labels.instance}}: {{ $value }} %\"\n  - alert: Low Volume Space\n    expr: (kubelet_volume_stats_available_bytes/kubelet_volume_stats_capacity_bytes and kubelet_volume_stats_capacity_bytes) * 100 \u003c 19\n    for: 1m\n    labels:\n      severity: critical\n    annotations:\n      summary: \"{{$labels.persistentvolumeclaim}}: {{ $value }} %\"\n      description: \"pool: {{ $labels.cloud_google_com_gke_nodepool }}\\n region: {{ $labels.failure_domain_beta_kubernetes_io_region }}\\n zone: {{ $labels.failure_domain_beta_kubernetes_io_zone }}\"\n  - alert: High CPU Usage\n    expr: sum (rate (container_cpu_usage_seconds_total{id=\"/\"}[10m])) / sum (machine_cpu_cores) * 100 \u003e 70\n    for: 1m\n    labels: \n      severity: warning\n    annotations:\n      summary: \"{{ $value }} %\"\n  - alert: Low Free Memory\n    expr: ((container_spec_memory_limit_bytes{id=\"/\"} - container_memory_working_set_bytes{id=\"/\"}) / container_spec_memory_limit_bytes{id=\"/\"} * 100) \u003c 15\n    for: 1m\n    labels: \n      severity: critical\n    annotations:\n      summary: \"{{$labels.instance}}: {{ $value }} %\"\n      description: \"pool: {{ $labels.cloud_google_com_gke_nodepool }}\\n region: {{ $labels.failure_domain_beta_kubernetes_io_region }}\\n zone: {{ $labels.failure_domain_beta_kubernetes_io_zone }}\"\n  - alert: Hight Network  Receive\n    expr: (sum (rate (container_network_receive_bytes_total[10m])) / 1024 / 1024 \u003e 60)\n    for: 10m\n    labels: \n      severity: warning\n    annotations:\n      summary: \"{{ $value }} MB/s\"\n  - alert: Hight Network Transmit\n    expr: (sum (rate (container_network_transmit_bytes_total[10m])) / 1024 / 1024 \u003e 20)\n    for: 10m\n    labels: \n      severity: warning\n    annotations:\n      summary: \"{{ $value }} MB/s\"\n  - alert: High_ErrorRate 5xx\n    expr: sum by(job,path)(rate(http_requests_total{code=~\"5..\"}[5m])) / sum by(job,path)(rate(http_requests_total[5m])) * 100 \u003e 1\n    for: 10m\n    labels: \n      severity: warning\n    annotations:\n      summary: \"{{$labels.instance}} high number of 5xx errors\"\n      description: \"{{$labels.instance}}: {{$labels.job}} has {{$value}}% 5xx errors on {{$labels.path}}\"\n  - alert: High_ErrorRate 4xx\n    expr: sum by(job,path)(rate(http_requests_total{code=~\"4..\"}[5m])) / sum by(job,path)(rate(http_requests_total[5m])) * 100 \u003e 1\n    for: 10m\n    labels: \n      severity: warning\n    annotations:\n      summary: \"{{$labels.instance}} high number of 4xx errors\"\n      description: \"{{$labels.instance}}: {{$labels.job}} has {{$value}}% 5xx errors on {{$labels.path}}\"\n  - alert: TooMany_OpenFileDescriptors\n    expr: 100 * (process_open_fds / process_max_fds) \u003e 50\n    for: 10m\n    labels:\n      severity: critical\n    annotations:\n      description: '{{ $labels.job }}: {{ $labels.namespace }}/{{ $labels.pod }} ({{$labels.instance }}) is using {{ $value }}% of the available file/socket descriptors.'\n      summary: Too many open file descriptors\n    #-------------------------------------------------------------------------------------------------------------------------------------------\n    # MongoDB alerts\n  - alert: MONGO_DB__TO_MANY_OPEN_CONNECTIONS\n    expr: mongodb_connections{state=\"current\"} \u003e 80\n    for: 2m\n    labels:\n      severity: warning\n    annotations:\n      description: \"value is higher ({{ $value }}) than expected (80) during last 2 minutes\"\n  - alert: MONGO_DB__REPLICATION_LAG_BY_SET\n    expr: max(mongodb_mongod_replset_member_optime_date{state=\"PRIMARY\"}) by (set) - min(mongodb_mongod_replset_member_optime_date{state=\"SECONDARY\"}) by (set)\u003e 15\n    for: 2m\n    labels:\n      severity: warning\n    annotations:\n      summary: Replication Lag by Set\n      description: \"value is higher ({{ $value }}) than expected (20) during last 2 minutes\"\n  - alert: MONGO_DB__UNEXPECTED_REPLICA_SET_STATE\n    expr: mongodb_mongod_replset_my_state!=1 and mongodb_mongod_replset_my_state!=2 and mongodb_mongod_replset_my_state!=7\n    for: 2m\n    labels:\n      severity: warning\n    annotations:\n      summary: Unexpected ReplicaSet State\n      description: \"value ({{ $value }}) is not of of PRIMARY,SECONDARY,ARBITER\"\n  - alert: MONGO_DB__MIN_RUN_INSTANCES\n    expr: count(mongodb_mongod_replset_member_health)\u003c3\n    for: 2m\n    labels:\n      severity: warning\n    annotations:\n      summary: Some MongoDB instances are not reachable\n      description: \"theare are only ({{ $value }}) instances\"\n  - alert: MGOB_DUMP_FAILED\n    expr: (sum (rate (mgob_scheduler_backup_latency{status=\"500\"}[10m]))  \u003e 0)\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Some MGOB dumps failed"},"kind":"ConfigMap","metadata":{"annotations":{},"labels":{"name":"prometheus-rules"},"name":"prometheus-rules","namespace":"monitoring"}}
  creationTimestamp: "2021-12-08T12:07:37Z"
  labels:
    name: prometheus-rules
  name: prometheus-rules
  namespace: monitoring
  resourceVersion: "558820735"
  uid: 79b538cf-9b02-454b-b876-09d12e4beeb5
